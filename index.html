<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Data KIB Aset Dinas Pendidikan dan Kebudayaan</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .eye-icon, .book-icon { cursor: pointer; display: inline-flex; justify-content: center; align-items: center; width: 1.5rem; height: 1.5rem; font-size: 1.25rem; }
  .eye-icon { color: #2563eb; }
  .book-icon { color: #16a34a; }
  .rotate-90 { transform: rotate(90deg); }
</style>
</head>
<body class="bg-gray-50 font-sans flex min-h-screen">

<!-- Sidebar -->
<nav id="sidebar" class="w-64 bg-white shadow-md border-r border-gray-200 flex flex-col fixed md:static inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-200 z-50">
  <div class="px-6 py-4 border-b border-gray-200 flex items-center gap-3">
    <img src="https://upload.wikimedia.org/wikipedia/commons/3/34/Lambang_Kabupaten_Donggala.png" alt="Lambang Kabupaten Donggala" class="h-8 w-auto object-contain" />
    <span class="text-lg font-semibold text-blue-700">ASET DIKBUD</span>
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Logo-Tut-Wuri-Handayani-PNG-Warna.png" alt="Logo Tut Wuri Handayani" class="h-8 w-auto object-contain ml-auto" />
  </div>

  <div class="group border-b border-gray-200">
    <a href="#" data-sheet="Master Data" class="px-6 py-3 text-gray-700 hover:text-blue-600 hover:bg-blue-50 block">Master Data</a>
  </div>

  <div class="group border-b border-gray-200">
    <button id="kibBtn" class="w-full flex justify-between items-center px-6 py-3 hover:bg-blue-100 focus:outline-none">
      <span class="font-medium text-gray-700">KIB</span>
      <svg id="kibArrow" class="w-4 h-4 text-gray-500 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
    </button>
    <div id="kibDropdown" class="hidden flex flex-col bg-gray-50 border-t border-gray-200">
      <a href="inputdata.html" class="px-10 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 kib-link">Input KIB B</a>
      <a href="#" class="px-10 py-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 kib-link">Input KIB C</a>
    </div>
  </div>
</nav>

<div class="flex-1 flex flex-col md:ml-64">
  <!-- Header Mobile -->
  <header class="bg-white shadow-md p-3 flex items-center md:hidden">
    <button id="menuBtn" class="p-2 text-gray-600 focus:outline-none">☰</button>
    <h1 class="ml-3 font-semibold text-gray-700">ASET DIKBUD</h1>
  </header>

  <main class="p-4 overflow-auto">
    <h2 class="text-xl md:text-2xl font-semibold mb-4 text-center text-gray-800">
      Data Satuan Pendidikan Jenjang SD-SMP Negeri dan Swasta
    </h2>

    <!-- Search -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
      <input id="searchInput" type="text" placeholder="Cari data sekolah..." class="w-full md:flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" />
    </div>

    <!-- Tabel -->
    <div class="overflow-x-auto max-w-full shadow rounded-lg bg-white">
      <table id="dataTable" class="min-w-full table-auto border-collapse border border-gray-300 text-xs md:text-sm">
        <thead class="bg-blue-600 text-white">
          <tr id="tableHeader" class="text-center"></tr>
        </thead>
        <tbody id="tableBody" class="divide-y divide-gray-200"></tbody>
      </table>
    </div>

    <nav aria-label="Pagination" class="mt-4 flex justify-center">
      <ul id="pagination" class="inline-flex space-x-1"></ul>
    </nav>
  </main>
</div>

<script>
  // Sidebar toggle
  const menuBtn=document.getElementById("menuBtn");
  const sidebar=document.getElementById("sidebar");
  if(menuBtn){ menuBtn.addEventListener("click",()=>{ sidebar.classList.toggle("-translate-x-full"); }); }

  function toggleDropdown(btnId,dropdownId,arrowId){
    const btn=document.getElementById(btnId);
    const dropdown=document.getElementById(dropdownId);
    const arrow=document.getElementById(arrowId);
    btn.addEventListener('click',()=>{ dropdown.classList.toggle('hidden'); arrow.classList.toggle('rotate-90'); });
  }
  toggleDropdown('kibBtn','kibDropdown','kibArrow');

  const SPREADSHEET_ID='152oNQyrJEeg-xW3okB2LKbGIUapxDakDMCbDjqpDl3U';
  const SHEET_NAME='Master Data';
  const rowsPerPage=20;
  let allData=[],filteredData=[],columns=[],colMap={};

  async function loadSheet(sheetName=SHEET_NAME){
    const url=`https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
    try{
      const res=await fetch(url);
      const text=await res.text();
      const jsonStr=text.substring(text.indexOf('{'),text.lastIndexOf('}')+1);
      const data=JSON.parse(jsonStr);

      const wantedCols=["Nama Sekolah","Jenjang","Status","Kecamatan","KIB Peralatan dan Mesin","Dokumen Barcode"];
      columns=data.table.cols.map(c=>c.label);
      colMap={};
      wantedCols.forEach(col=>{ colMap[col]=columns.findIndex(c=>c && c.toLowerCase().includes(col.toLowerCase())); });

      const rows=data.table.rows;
      allData=rows.map(r=>{
        return wantedCols.map(col=>{
          const idx=colMap[col];
          return idx>=0 && r.c[idx]?r.c[idx].v:"";
        });
      });

      filteredData=[...allData];
      renderTableHeader(wantedCols);
      renderTablePage(1);
    }catch(e){console.error(e);}
  }

  function renderTableHeader(cols){
    const headerRow=document.getElementById('tableHeader'); headerRow.innerHTML='';
    cols.forEach(col=>{
      const th=document.createElement('th');
      th.textContent=col;
      th.className='px-2 md:px-4 py-2 border border-blue-700 font-semibold text-xs md:text-sm';
      headerRow.appendChild(th);
    });
  }

  function renderTablePage(page){
    const tbody=document.getElementById('tableBody'); tbody.innerHTML='';
    const start=(page-1)*rowsPerPage,end=start+rowsPerPage;
    filteredData.slice(start,end).forEach(row=>{
      const tr=document.createElement('tr'); tr.className='hover:bg-gray-100 transition';
      row.forEach((cell,idx)=>{
        const td=document.createElement('td'); td.className='px-2 md:px-4 py-1 md:py-2 border border-gray-300 align-middle whitespace-nowrap text-left';
        const colName=Object.keys(colMap)[idx];
        if(colName==="KIB Peralatan dan Mesin" && isValidUrl(cell)){
          td.classList.add('text-center');
          td.innerHTML=`<a href="${cell}" target="_blank" rel="noopener noreferrer" class="eye-icon" title="Lihat detail">&#128065;</a>`;
        }else if(colName==="Dokumen Barcode" && isValidUrl(cell)){
          td.classList.add('text-center');
          td.innerHTML=`<a href="${cell}" target="_blank" rel="noopener noreferrer" class="book-icon" title="Lihat Dokumen">&#128214;</a>`;
        }else{
          td.textContent=cell;
        }
        tr.appendChild(td);
      }); tbody.appendChild(tr);
    });
    renderPagination(page);
  }

  function renderPagination(currentPage){
    const totalPages=Math.ceil(filteredData.length/rowsPerPage);
    const pagination=document.getElementById('pagination'); pagination.innerHTML='';
    function createPageItem(page,label=null,disabled=false,active=false){
      const li=document.createElement('li'); const btn=document.createElement('button');
      btn.textContent=label||page; btn.disabled=disabled;
      btn.className=`px-2 md:px-3 py-1 rounded text-xs md:text-sm ${active?'bg-blue-600 text-white':'bg-white text-blue-600 hover:bg-blue-100'} disabled:opacity-50`;
      btn.addEventListener('click',()=>{if(!disabled) renderTablePage(page);}); li.appendChild(btn); return li;
    }
    pagination.appendChild(createPageItem(currentPage-1,'« Prev',currentPage===1));
    for(let i=1;i<=totalPages;i++) pagination.appendChild(createPageItem(i,null,false,i===currentPage));
    pagination.appendChild(createPageItem(currentPage+1,'Next »',currentPage===totalPages));
  }

  function isValidUrl(str){ try{ new URL(str); return true; } catch{return false;} }

  // Search
  document.getElementById('searchInput').addEventListener('input',()=>{
    const searchTerm=document.getElementById('searchInput').value.toLowerCase();
    filteredData=allData.filter(row=>searchTerm===''||row.some(cell=>String(cell).toLowerCase().includes(searchTerm)));
    renderTablePage(1);
  });

  document.querySelectorAll('[data-sheet]').forEach(link=>{
    link.addEventListener('click',e=>{e.preventDefault(); loadSheet(link.getAttribute('data-sheet'));});
  });

  loadSheet();
</script>
</body>
</html>
